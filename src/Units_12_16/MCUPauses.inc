;=============================================================================
;Процедуры пауз, не зависящие от быстродействия МК
;Все процедуры нечувствительны в выбору банка и могут портить W (см. описание)
;=============================================================================

;До подключения модуля описать в программе константу MCU_Speed, определяющую
;скорость работы МК. Допустимые значения:
;	#define		MCU_Speed	.1000		;Скорость работы МК 1 MIPS (Fosc = 4 МГц)
;	#define		MCU_Speed	.5000		;Скорость работы МК 5 MIPS (Fosc = 20 МГц)

;Длительности пауз не учитывают время на обработку прерываний во время их выполнения (если есть)!

;===== МАКРОСЫ ПАУЗ ==========================================================

;Пауза 1 мкс
MCUPause_1mks	MACRO
	IF	(MCU_Speed==.1000)
		nop				;1 такт
	ENDIF
	IF	(MCU_Speed==.5000)
		call	MCUP_4Takts		;4 такта
		nop				;1 такт
	ENDIF
		ENDM

;Пауза 2 мкс
MCUPause_2mks	MACRO
	IF	(MCU_Speed==.1000)
		nop2				;2 такта
	ENDIF
	IF	(MCU_Speed==.5000)
		call	MCUP_4Takts		;4 такта
		call	MCUP_4Takts		;4 такта
		nop2				;2 такта
	ENDIF
		ENDM

;Пауза 6 мкс. Портит W
MCUPause_6mks	MACRO
	IF	(MCU_Speed==.1000)
		call	MCUP_4Takts		;4 такта
		nop2				;2 такта
	ENDIF
	IF	(MCU_Speed==.5000)
		movlw	.6			;1 такт
		call	MCUP_Wx4Plus3T		;6*4+3 = 27 тактов
		nop2				;2 такта
	ENDIF
		ENDM

;Пауза N мкс. Портит W
;Органичения на значения N:
;	1 MIPS: 8..1024, строго кратно 4
;	5 MIPS: 4..204, строго кратно 4
;Итоговое ограничение: 8..204, строго кратно 4
MCUPause_mks	MACRO	N
	IF	(MCU_Speed==.1000)
		movlw	(N-4)/4			;1 такт
		call	MCUP_Wx4Plus3T		;[(N-4)/4]*4+3 = N-1 тактов
	ENDIF
	IF	(MCU_Speed==.5000)
		movlw	(N*5-4)/4		;1 такт
		call	MCUP_Wx4Plus3T		;[(N*5-4)/4]*4+3 = N*5-1 тактов
	ENDIF
		ENDM

;===== СЛУЖЕБНЫЕ ПРОЦЕДУРЫ ===================================================

;Служебная для организации пауз: пауза W*4+3 вместе с вызовом
MCUP_Wx4Plus3T:	decw
		If_NZ
		  goto	$-2
MCUP_4Takts:	return

;=============================================================================
