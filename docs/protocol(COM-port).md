#### **ИНТЕРФЕЙС ОБМЕНА ЧЕРЕЗ ВИРТУАЛЬНЫЙ COM-ПОРТ**

**ОБОЗНАЧЕНИЯ:**

**\*** – передаваемая или принимаемая шестнадцатеричная цифра (0–F [символы A–F заглавные!])

**ПАРАМЕТРЫ СВЯЗИ:**

Скорость обмена 2400 бод, 1 стоп-бит, без чётности.
Инициатором связи на линии всегда служит ПК, без запроса прибор ничего не выдаёт.
Связь с прибором допускается только после его регистрации в сотовой сети при отсутствии активности в ней (не принимаются и не отправляются смс).

| **Ком.**                                  | **Описание команды, параметров и результата**                                                                                                                         | **Интерфейс**                                                       |
| :---------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------ |
| **_Команды чтения параметров EEPROM_**    |                                                                                                                                                                       |                                                                     |
| **n**                                     | Выдача сохранённого номера телефона в символьном виде.                                                                                                                | **n<+7xxxxxxxxxx>**                                                 |
| **g**                                     | Выдача сохранённой глубины.                                                                                                                                           | **g<\*\*\*\*>**                                                     |
| **_Команды измерений_**                   |                                                                                                                                                                       |                                                                     |
| **t**                                     | <p>Измерение и выдача температуры в °C.</p><p>Значения выдаются в дополнительном коде (FF = –1°C и т. п.).</p><p>Ошибки: 80 – датчик отсутствует.</p>                 | **t<\*\*>**                                                         |
| **r**                                     | <p>Измерение и выдача расстояния в см.</p><p>Ошибки: 0000 – датчик отсутствует; FFFF – ошибка измерения.</p>                                                          | **r<\*\*\*\*>**                                                     |
| **a**                                     | Чтение состояния входа «Тревога» (1 = высокий уровень).                                                                                                               | **a<\*>**                                                           |
| **_Команды управления журналом событий_** |                                                                                                                                                                       |                                                                     |
| **l**                                     | <p>Чтение журнала событий с его очисткой.</p><p>Выдаёт все записи, содержащиеся в журнале, начиная с самой старой, при этом выданные записи удаляются из журнала.</p> | <p>**l<>**</p><p>**l<\*\*>**</p><p>**l<\*\*,\*\*,\*\*,…,\*\*>**</p> |
| **c**                                     | Очистка журнала событий без чтения.                                                                                                                                   | **c<>**                                                             |

**ФОРМАТ ЗАПИСИ ЖУРНАЛА СОБЫТИЙ:**

Одна запись – один байт. Формат записи побитно от старшего к младшему: KKKKNNNR.

| **KKKK**                                  | **NNN**                                                                                                                                                                                                                                      | **R**                                  |
| :---------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------- |
| 0001 – запуск (перезапуск) модуля SIM900D | <p>111 – начало запуска</p><p>000 – произведён успешный запуск</p>                                                                                                                                                                           | 0                                      |
| 0010 – получение распознанной смс         | <p>001 – SetThisNumber</p><p>010 – T</p><p>011 – R</p><p>100 – ObratnoeR</p><p>101 – Glubina с корректным значением</p><p>Примечание. Смс с нераспознанными командами, а также Glubina с некорректным значением удаляются без сохранения</p> | 0                                      |
| 0011 – измерение                          | <p>001 – температуры</p><p>010 – расстояния</p>                                                                                                                                                                                              | <p>0 – успешно</p><p>1 – ошибка</p>    |
| 0100 – отправка смс                       | <p>001 – ответ на SetThisNumber</p><p>010 – температура</p><p>011 – расстояние</p><p>100 – обратное расстояние</p><p>101 – значение глубины</p><p>110 – «Света нет»</p>                                                                      | <p>0 – отправлено</p><p>1 – ошибка</p> |
| 1111 – сбой связи с модулем               | 000                                                                                                                                                                                                                                          | 0                                      |

Пример: 01000101 (0x45) – неудачная отправка смс с температурой.
